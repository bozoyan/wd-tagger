# AI 图像打标器

这是一个基于 Gradio 构建的Web应用，旨在为用户提供强大而灵活的图像标签生成功能。它结合了高效的本地模型和先进的在线AI服务，帮助用户快速获取图像的描述性标签，特别适用于AI绘画的Prompt创作。

## 主要功能

- **双模式操作**:
  - **本地模型打标**: 利用内置的 `wd-swinv2-tagger-v3` ONNX模型，可以快速分析本地上传的图片，生成一系列精准的英文描述标签，并附带中文翻译。
  - **智谱AI反推**: 集成了强大的智谱AI `glm-4.1v-thinking-flashx` 在线模型。用户只需提供一张图片的URL，即可获得由AI生成的高质量、详细的中英文绘画Prompt，并自动提取对应的标签。

- **参数可调**: 在使用本地模型时，用户可以根据需求自由调整“常规标签”和“角色标签”的识别阈值，以控制标签生成的粒度。

- **中英双语支持**: 本地模型生成的标签会自动查询翻译库，同时提供中英文结果，方便不同语言习惯的用户。

- **简单易用的界面**: 所有功能都集成在一个简洁直观的Web界面中，用户无需关心复杂的背后技术，即可轻松上手。

## 环境要求

1.  **Python环境**: 确保您的系统中已安装 Python。
2.  **依赖库**: 需要安装项目所需的Python库。您可以通过 `requirements.txt` 文件进行安装：
    ```bash
    pip install -r requirements.txt
    ```
    主要依赖包括 `gradio`, `onnxruntime`, `pandas`, `zhipuai` 等。

3.  **智谱AI API Key**:
    - 如果要使用“智谱AI图片反推”功能，您必须拥有一个智谱AI的API Key。
    - 请将您的API Key设置为系统环境变量，变量名为 `ZHIPUAI_API_KEY`。程序会自动从此环境变量中读取。

## 如何使用

1.  **启动应用**: 在项目根目录下，运行以下命令：
    ```bash
    python app.py
    ```
    应用启动后，会自动在浏览器中打开 `http://127.0.0.1:8088`。

2.  **使用本地模型进行打标**:
    - 在左侧的“输入图像”区域，点击上传或直接拖入一张本地图片。
    - （可选）根据需要，拖动下方的滑块来调整“常规标记阈值”和“字符标签阈值”。
    - 点击 **“本地模型打Tag标签”** 按钮。
    - 稍等片刻，右侧的“Tag标签（字符串）”和“中文翻译”文本框中就会显示生成的标签。

3.  **使用智谱AI进行图片反推**:
    - 在左上方的“图片 URL”输入框中，粘贴一个可公开访问的图片链接。
    - 点击 **“智谱AI 图片反推”** 按钮。
    - 处理需要一些时间。完成后，右侧的“图片反推数据”框将显示由智谱AI返回的完整详细描述，同时上方的标签框也会被自动提取并填充。

## 文件结构简介

- `app.py`: 应用的主程序文件。
- `requirements.txt`: 项目所需的Python依赖库列表。
- `model/`: 存放本地模型和标签数据的目录。
  - `model.onnx`: `wd-swinv2-tagger-v3` 的ONNX模型文件。
  - `selected_tags.csv`: 模型的英文标签库。
  - `selected_tags_zh_CN.csv`: 英文标签对应的中文翻译文件。
